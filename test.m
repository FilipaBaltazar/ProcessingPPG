sg=[0.0, 0.5204644111534157, 0.9294867526321058, 1.1419152011275586, 1.118969854527415, 0.8773734640669093, 0.4853749992705909, 0.04660517613775794, -0.3244233488214577, -0.5293852423019267, -0.5093885435772327, -0.2589077091695152, 0.17288680065451179, 0.6937164448219933, 1.1899635171832474, 1.5534802191953732, 1.7071067811865475, 1.6228723897033142, 1.328580686382339, 0.9012246718102055, 0.4487861799374554, 0.08471815663753501, -0.0988640160548756, -0.052951042608765375, 0.21677275132473828, 0.6512593879285573, 1.1520306577483361, 1.6044245373581887, 1.904664812914517, 1.9843612366369778, 1.8266543389747425, 1.4701921930311705, 1.0000000000000007, 0.5273987193791767, 0.16371511436965192, -0.006008216707415692, 0.05690574789194358, 0.33563796903089693, 0.7618500137160806, 1.2318287424374814, 1.6309863136978344, 1.8609296288556518, 1.8627065447515854, 1.63073906336301, 1.2141530446676347, 0.7051903911510855, 0.21744022034313437, -0.1409701389933956, -0.2928932188134524, -0.21036230950133683, 0.0788230511440412, 0.49768216416287225, 0.9382536653846898, 1.2871131975559584, 1.452182017229228, 1.384495429162491, 1.0897902135516389, 0.6271745306466827, 0.09519435523833586, -0.39141310426038156, -0.7287892104951575, -0.848454252216835, -0.7334524719729851, -0.42232906249857927, -1.102182119232618e-15, 0.4223290624985774, 0.7334524719729821, 0.848454252216835, 0.7287892104951588, 0.3914131042603809, -0.0951943552383297, -0.6271745306466803, -1.0897902135516369, -1.3844954291624911, -1.4521820172292288, -1.2871131975559598, -0.9382536653846918, -0.4976821641628709, -0.07882305114404597, 0.21036230950133583, 0.29289321881345254, 0.1409701389933985, -0.21744022034313182, -0.7051903911510832, -1.2141530446676356, -1.6307390633630061, -1.862706544751585, -1.8609296288556523, -1.6309863136978333, -1.2318287424374872, -0.7618500137160829, -0.33563796903089893, -0.056905747891943026, 0.006008216707416358, -0.16371511436965058, -0.5273987193791746, -0.9999999999999946, -1.470192193031167, -1.8266543389747412, -1.9843612366369778, -1.9046648129145192, -1.604424537358192, -1.1520306577483383, -0.651259387928558, -0.21677275132474239, 0.05295104260876471, 0.0988640160548756, -0.0847181566375359, -0.44878617993745173, -0.9012246718102035, -1.3285806863823386, -1.6228723897033146, -1.7071067811865477, -1.5534802191953747, -1.1899635171832483, -0.6937164448219992, -0.17288680065451567, 0.258907709169514, 0.5093885435772326, 0.5293852423019278, 0.3244233488214594, -0.04660517613775639, -0.4853749992705913, -0.8773734640669061, -1.1189698545274143, -1.1419152011275593, -0.9294867526321052, -0.5204644111534196, -2.6942229581241772e-15, 0.5204644111534147, 0.929486752632102, 1.1419152011275584, 1.1189698545274185, 0.8773734640669094, 0.4853749992705956, 0.046605176137753834, -0.3244233488214564, -0.5293852423019247, -0.5093885435772325, -0.25890770916951755, 0.17288680065450424, 0.6937164448219939, 1.189963517183244, 1.5534802191953754, 1.7071067811865475, 1.6228723897033168, 1.3285806863823364, 0.901224671810208, 0.4487861799374626, 0.08471815663753424, -0.09886401605487483, -0.05295104260876837, 0.21677275132473883, 0.6512593879285532, 1.1520306577483406, 1.604424537358188, 1.9046648129145143, 1.9843612366369776, 1.8266543389747438, 1.4701921930311777, 0.9999999999999996, 0.5273987193791789, 0.16371511436965724, -0.006008216707415692, 0.05690574789194147, 0.33563796903090093, 0.761850013716078, 1.2318287424374756, 1.630986313697835, 1.8609296288556512, 1.8627065447515874, 1.6307390633630092, 1.2141530446676405, 0.7051903911510813, 0.21744022034313681, -0.14097013899339195, -0.29289321881345165, -0.2103623095013385, 0.0788230511440361, 0.4976821641628731, 0.9382536653846876, 1.2871131975559527, 1.4521820172292284, 1.3844954291624934, 1.0897902135516362, 0.6271745306466857, 0.0951943552383428, -0.39141310426038295, -0.7287892104951572, -0.8484542522168362, -0.7334524719729847, -0.4223290624985843, -1.0411973715298856e-14, 0.42232906249857854, 0.7334524719729815, 0.8484542522168361, 0.7287892104951608, 0.39141310426038944, -0.09519435523833492, -0.627174530646678, -1.0897902135516302, -1.3844954291624907, -1.452182017229229, -1.2871131975559567, -0.9382536653846939, -0.49768216416287986, -0.07882305114404164, 0.2103623095013356, 0.2928932188134521, 0.14097013899339583, -0.21744022034313026, -0.7051903911510736, -1.2141530446676332, -1.6307390633630043, -1.8627065447515858, -1.860929628855653, -1.63098631369784, -1.2318287424374825, -0.761850013716085, -0.33563796903090637, -0.05690574789194425, 0.006008216707416469, -0.16371511436965314, -0.5273987193791725, -0.9999999999999921, -1.470192193031171, -1.8266543389747398, -1.984361236636977, -1.9046648129145174, -1.6044245373581942, -1.1520306577483477, -0.6512593879285602, -0.21677275132474427, 0.05295104260876593, 0.09886401605487594, -0.0847181566375299, -0.4487861799374561, -0.9012246718102012, -1.3285806863823315, -1.6228723897033144, -1.7071067811865483, -1.5534802191953787, -1.1899635171832499, -0.6937164448220018, -0.17288680065451162, 0.2589077091695122, 0.5093885435772305, 0.5293852423019262, 0.32442334882146084, -0.04660517613774828, -0.48537499927058997, -0.8773734640669035, -1.1189698545274156, -1.141915201127559, -0.9294867526321108, -0.5204644111534157, -5.3884459162483544e-15, 0.520464411153406, 0.9294867526321043, 1.141915201127557, 1.1189698545274183, 0.8773734640669102, 0.48537499927059863, 0.04660517613777038, -0.32442334882144486, -0.5293852423019284, -0.5093885435772332, -0.25890770916951933, 0.1728868006545018, 0.6937164448219771, 1.1899635171832528, 1.5534802191953734, 1.707106781186548, 1.6228723897033184, 1.3285806863823506, 0.9012246718102245, 0.4487861799374515, 0.08471815663753557, -0.09886401605487449, -0.05295104260876926, 0.21677275132472695, 0.651259387928564, 1.152030657748338, 1.6044245373581862, 1.9046648129145136, 1.9843612366369794, 1.8266543389747372, 1.4701921930311672, 1.000000000000002, 0.5273987193791811, 0.16371511436965858, -0.006008216707414027, 0.056905747891946024, 0.33563796903089904, 0.7618500137160757, 1.2318287424374734, 1.6309863136978233, 1.8609296288556547, 1.8627065447515854, 1.630739063363011, 1.2141530446676427, 0.705190391151098, 0.2174402203431508, -0.14097013899339728, -0.29289321881345143, -0.21036230950133938, 0.0788230511440342, 0.4976821641628567, 0.9382536653846987, 1.2871131975559602, 1.452182017229228, 1.3844954291624942, 1.0897902135516482, 0.627174530646702, 0.0951943552383315, -0.3914131042603808, -0.7287892104951561, -0.8484542522168361, -0.7334524719729938, -0.4223290624985737, 1.5945167614379127e-15, 0.4223290624985766, 0.7334524719729804, 0.8484542522168348, 0.7287892104951674, 0.39141310426038056, -0.09519435523833059, -0.6271745306466755, -1.0897902135516266, -1.3844954291624854, -1.452182017229225, -1.287113197555958, -0.9382536653846973, -0.4976821641628821, -0.07882305114405663, 0.21036230950134127, 0.2928932188134523, 0.1409701389933984, -0.21744022034312804, -0.70519039115107, -1.2141530446676176, -1.630739063363011, -1.862706544751585, -1.8609296288556543, -1.6309863136978415, -1.2318287424374987, -0.7618500137160734, -0.33563796903089727, -0.05690574789194469, 0.0060082167074168025, -0.1637151143696437, -0.5273987193791578, -1.000000000000004, -1.4701921930311688, -1.8266543389747385, -1.984361236636977, -1.9046648129145236, -1.604424537358185, -1.1520306577483361, -0.6512593879285631, -0.21677275132474605, 0.05295104260876038, 0.09886401605487904, -0.08471815663753657, -0.4487861799374541, -0.9012246718101978, -1.3285806863823295, -1.6228723897033055, -1.7071067811865488, -1.5534802191953734, -1.1899635171832534, -0.6937164448220045, -0.17288680065452866, 0.25890770916950145, 0.5093885435772341, 0.5293852423019267, 0.324423348821464, -0.04660517613774623, -0.48537499927057215, -0.8773734640669145, -1.118969854527415, -1.1419152011275613, -0.9294867526321123, -0.5204644111534323];
sgfiltered=[0.0, -0.0015690109107052619, -0.004429697419753947, -0.008165510828908058, -0.011977654960338063, -0.014403236077006668, -0.013142507584269693, -0.005138565752624312, 0.013006281145930127, 0.04429443883308804, 0.09041021998573731, 0.1508391129930903, 0.22230066291990513, 0.29873514186973255, 0.37197701123658256, 0.43308511301932107, 0.4741186641245034, 0.48999689579615685, 0.48000320809531644, 0.4485214408942537, 0.40472725191973125, 0.3611785794302403, 0.331508281590571, 0.32765767827653874, 0.35724084202668205, 0.4216512704045561, 0.5153989903813385, 0.6269160707317597, 0.7407434242462065, 0.8406850934818242, 0.9132665243106106, 0.9525341472668699, 0.9583933632074637, 0.938177782120135, 0.904896335575708, 0.8741412818182877, 0.8603873489853978, 0.8735560463145297, 0.9166565487682709, 0.9850603165299745, 1.0675807889088236, 1.1491032070822347, 1.2141435422166824, 1.2504960868813588, 1.2521083256590044, 1.2205041810853139, 1.1644195394521915, 1.0977361408336095, 1.0362017680252422, 0.9937112899808035, 0.9790268191230589, 0.9937115381886387, 1.0317651314500271, 1.0810469049013487, 1.1261505002461611, 1.1520512991959873, 1.1476651344346975, 1.1084778656863075, 1.0376247980215256, 0.9451649974949479, 0.8457218443837617, 0.7550469862782735, 0.6863190973191461, 0.6470514743628867, 0.6373387165526337, 0.6498564974205383, 0.671614430070753, 0.6870480174134843, 0.6817194420658035, 0.6457531662238558, 0.5761949362885243, 0.4777370310593814, 0.3616384142768354, 0.24309473745443605, 0.13767921688047285, 0.05769482734392586, 0.009299197198050549, -0.008918890805301375, -0.005575296835843504, 0.005575296835843084, 0.008918890805301016, -0.009299197198050767, -0.05769482734392589, -0.13767921688047277, -0.24309473745443574, -0.3616384142768351, -0.4777370310593811, -0.576194936288524, -0.6457531662238557, -0.6817194420658031, -0.6870480174134843, -0.6716144300707527, -0.6498564974205382, -0.6373387165526337, -0.6470514743628862, -0.686319097319146, -0.7550469862782727, -0.8457218443837612, -0.9451649974949478, -1.0376247980215254, -1.1084778656863068, -1.1476651344346973, -1.1520512991959866, -1.1261505002461611, -1.081046904901349, -1.0317651314500271, -0.9937115381886382, -0.9790268191230584, -0.9937112899808028, -1.0362017680252413, -1.0977361408336088, -1.1644195394521906, -1.2205041810853134, -1.2521083256590044, -1.2504960868813586, -1.2141435422166822, -1.1491032070822342, -1.067580788908824, -0.9850603165299753, -0.9166565487682716, -0.8735560463145303, -0.8603873489853985, -0.874141281818288, -0.9048963355757084, -0.9381777821201357, -0.9583933632074644, -0.9525341472668708, -0.9132665243106114, -0.8406850934818252, -0.7423124351569131, -0.6313457681515144, -0.5235645012102472, -0.4336289253648948, -0.3716440781036892, -0.34080018586080874, -0.3366468473431956, -0.3481722982843103, -0.3604328130866433, -0.3581112209085164, -0.32916409510222633, -0.26769623287625216, -0.17538352225477116, -0.0611081017827391, 0.06110810178273812, 0.17538352225477036, 0.2676962328762513, 0.32916409510222583, 0.358111220908516, 0.36043281308664293, 0.3481722982843097, 0.3366468473431949, 0.340800185860808, 0.371644078103688, 0.43362892536489345, 0.5235645012102458, 0.6313457681515127, 0.7423124351569115, 0.8406850934818239, 0.9132665243106104, 0.9525341472668701, 0.9583933632074638, 0.9381777821201356, 0.9048963355757085, 0.8741412818182882, 0.8603873489853984, 0.8735560463145301, 0.9166565487682713, 0.9850603165299752, 1.067580788908824, 1.1491032070822342, 1.2141435422166833, 1.2504960868813597, 1.2521083256590058, 1.2205041810853152, 1.164419539452193, 1.0977361408336108, 1.0362017680252436, 0.9937112899808044, 0.9790268191230598, 0.993711538188639, 1.0317651314500274, 1.0810469049013491, 1.1261505002461616, 1.1520512991959873, 1.1476651344346975, 1.1084778656863075, 1.037624798021526, 0.945164997494948, 0.8457218443837617, 0.7550469862782734, 0.686319097319146, 0.6470514743628862, 0.6373387165526333, 0.6498564974205375, 0.6716144300707522, 0.6870480174134836, 0.6817194420658028, 0.6457531662238557, 0.576194936288524, 0.4777370310593812, 0.36163841427683524, 0.24309473745443574, 0.13767921688047252, 0.0576948273439253, 0.009299197198049843, -0.008918890805302193, -0.005575296835844247, 0.005575296835842504, 0.008918890805300696, -0.009299197198050724, -0.057694827343925524, -0.13767921688047208, -0.24309473745443483, -0.361638414276834, -0.47773703105938, -0.5761949362885231, -0.6457531662238548, -0.6817194420658024, -0.6870480174134836, -0.6716144300707525, -0.6498564974205379, -0.6373387165526332, -0.6470514743628859, -0.6863190973191454, -0.7550469862782723, -0.8457218443837607, -0.9451649974949468, -1.0376247980215245, -1.1084778656863061, -1.1476651344346969, -1.1520512991959866, -1.1261505002461618, -1.0810469049013498, -1.0317651314500285, -0.9937115381886393, -0.97902681912306, -0.9937112899808042, -1.0362017680252424, -1.0977361408336102, -1.1644195394521915, -1.220504181085314, -1.2521083256590055, -1.2504960868813597, -1.2141435422166835, -1.1491032070822356, -1.0675807889088254, -0.985060316529976, -0.9166565487682721, -0.8735560463145305, -0.8603873489853983, -0.8741412818182879, -0.9048963355757081, -0.9381777821201354, -0.9583933632074639, -0.9525341472668702, -0.9132665243106113, -0.8406850934818252, -0.7423124351569129, -0.6313457681515143, -0.5235645012102471, -0.4336289253648945, -0.37164407810368877, -0.34080018586080824, -0.33664684734319505, -0.34817229828430973, -0.360432813086643, -0.35811122090851627, -0.32916409510222633, -0.2676962328762523, -0.17538352225477158, -0.061108101782739344, 0.06110810178273795, 0.17538352225477047, 0.267696232876252, 0.329164095102227, 0.35811122090851766, 0.36043281308664493, 0.34817229828431184, 0.336646847343197, 0.3408001858608097, 0.3716440781036896, 0.4336289253648948, 0.5235645012102468, 0.6313457681515137, 0.7423124351569123, 0.8406850934818247, 0.9132665243106118, 0.9525341472668717, 0.9583933632074657, 0.9381777821201374, 0.9048963355757104, 0.8741412818182898, 0.8603873489853995, 0.8735560463145309, 0.9166565487682713, 0.9850603165299745, 1.067580788908823, 1.1491032070822333, 1.214143542216682, 1.2504960868813586, 1.252108325659004, 1.2205041810853137, 1.1644195394521917, 1.0977361408336093, 1.0362017680252424, 0.9937112899808035, 0.9790268191230586, 0.9937115381886386, 1.0317651314500271, 1.081046904901349, 1.1261505002461614, 1.152051299195988, 1.1476651344346986, 1.108477865686309, 1.0376247980215278, 0.9451649974949501, 0.8457218443837641, 0.7550469862782757, 0.6863190973191482, 0.6470514743628883, 0.6373387165526355, 0.6498564974205397, 0.6716144300707545, 0.6870480174134858, 0.6817194420658053, 0.6457531662238583, 0.576194936288527, 0.4777370310593841, 0.3616384142768382, 0.2430947374544386, 0.13767921688047513, 0.05769482734392773, 0.009299197198052079, -0.008918890805300114, -0.005575296835842241, 0.005575296835844316, 0.008918890805302527, -0.009299197198048984, -0.057694827343923796, -0.13767921688047047, -0.24309473745443325, -0.3616384142768327, -0.4777370310593788, -0.5761949362885223, -0.6457531662238541, -0.6817194420658022, -0.6870480174134836, -0.6716144300707524, -0.6498564974205376, -0.6373387165526333, -0.6470514743628857, -0.6863190973191448, -0.7550469862782715, -0.8457218443837594, -0.9451649974949459, -1.0376247980215236, -1.1084778656863052, -1.1476651344346962, -1.1520512991959857, -1.1261505002461603, -1.0810469049013476, -1.0317651314500265, -0.9937115381886373, -0.9790268191230573, -0.9937112899808014, -1.0362017680252402, -1.0977361408336073, -1.164419539452189, -1.2205041810853117, -1.2521083256590038, -1.250496086881358, -1.214143542216682, -1.1491032070822342, -1.0675807889088238, -0.9850603165299752, -0.9166565487682713, -0.8735560463145298, -0.860387348985397, -0.8741412818182872, -0.9048963355757077, -0.938177782120135, -0.9583933632074637, -0.9525341472668707, -0.9132665243106118];
t=[0.0, 0.0078125, 0.015625, 0.0234375, 0.03125, 0.0390625, 0.046875, 0.0546875, 0.0625, 0.0703125, 0.078125, 0.0859375, 0.09375, 0.1015625, 0.109375, 0.1171875, 0.125, 0.1328125, 0.140625, 0.1484375, 0.15625, 0.1640625, 0.171875, 0.1796875, 0.1875, 0.1953125, 0.203125, 0.2109375, 0.21875, 0.2265625, 0.234375, 0.2421875, 0.25, 0.2578125, 0.265625, 0.2734375, 0.28125, 0.2890625, 0.296875, 0.3046875, 0.3125, 0.3203125, 0.328125, 0.3359375, 0.34375, 0.3515625, 0.359375, 0.3671875, 0.375, 0.3828125, 0.390625, 0.3984375, 0.40625, 0.4140625, 0.421875, 0.4296875, 0.4375, 0.4453125, 0.453125, 0.4609375, 0.46875, 0.4765625, 0.484375, 0.4921875, 0.5, 0.5078125, 0.515625, 0.5234375, 0.53125, 0.5390625, 0.546875, 0.5546875, 0.5625, 0.5703125, 0.578125, 0.5859375, 0.59375, 0.6015625, 0.609375, 0.6171875, 0.625, 0.6328125, 0.640625, 0.6484375, 0.65625, 0.6640625, 0.671875, 0.6796875, 0.6875, 0.6953125, 0.703125, 0.7109375, 0.71875, 0.7265625, 0.734375, 0.7421875, 0.75, 0.7578125, 0.765625, 0.7734375, 0.78125, 0.7890625, 0.796875, 0.8046875, 0.8125, 0.8203125, 0.828125, 0.8359375, 0.84375, 0.8515625, 0.859375, 0.8671875, 0.875, 0.8828125, 0.890625, 0.8984375, 0.90625, 0.9140625, 0.921875, 0.9296875, 0.9375, 0.9453125, 0.953125, 0.9609375, 0.96875, 0.9765625, 0.984375, 0.9921875, 1.0, 1.0078125, 1.015625, 1.0234375, 1.03125, 1.0390625, 1.046875, 1.0546875, 1.0625, 1.0703125, 1.078125, 1.0859375, 1.09375, 1.1015625, 1.109375, 1.1171875, 1.125, 1.1328125, 1.140625, 1.1484375, 1.15625, 1.1640625, 1.171875, 1.1796875, 1.1875, 1.1953125, 1.203125, 1.2109375, 1.21875, 1.2265625, 1.234375, 1.2421875, 1.25, 1.2578125, 1.265625, 1.2734375, 1.28125, 1.2890625, 1.296875, 1.3046875, 1.3125, 1.3203125, 1.328125, 1.3359375, 1.34375, 1.3515625, 1.359375, 1.3671875, 1.375, 1.3828125, 1.390625, 1.3984375, 1.40625, 1.4140625, 1.421875, 1.4296875, 1.4375, 1.4453125, 1.453125, 1.4609375, 1.46875, 1.4765625, 1.484375, 1.4921875, 1.5, 1.5078125, 1.515625, 1.5234375, 1.53125, 1.5390625, 1.546875, 1.5546875, 1.5625, 1.5703125, 1.578125, 1.5859375, 1.59375, 1.6015625, 1.609375, 1.6171875, 1.625, 1.6328125, 1.640625, 1.6484375, 1.65625, 1.6640625, 1.671875, 1.6796875, 1.6875, 1.6953125, 1.703125, 1.7109375, 1.71875, 1.7265625, 1.734375, 1.7421875, 1.75, 1.7578125, 1.765625, 1.7734375, 1.78125, 1.7890625, 1.796875, 1.8046875, 1.8125, 1.8203125, 1.828125, 1.8359375, 1.84375, 1.8515625, 1.859375, 1.8671875, 1.875, 1.8828125, 1.890625, 1.8984375, 1.90625, 1.9140625, 1.921875, 1.9296875, 1.9375, 1.9453125, 1.953125, 1.9609375, 1.96875, 1.9765625, 1.984375, 1.9921875, 2.0, 2.0078125, 2.015625, 2.0234375, 2.03125, 2.0390625, 2.046875, 2.0546875, 2.0625, 2.0703125, 2.078125, 2.0859375, 2.09375, 2.1015625, 2.109375, 2.1171875, 2.125, 2.1328125, 2.140625, 2.1484375, 2.15625, 2.1640625, 2.171875, 2.1796875, 2.1875, 2.1953125, 2.203125, 2.2109375, 2.21875, 2.2265625, 2.234375, 2.2421875, 2.25, 2.2578125, 2.265625, 2.2734375, 2.28125, 2.2890625, 2.296875, 2.3046875, 2.3125, 2.3203125, 2.328125, 2.3359375, 2.34375, 2.3515625, 2.359375, 2.3671875, 2.375, 2.3828125, 2.390625, 2.3984375, 2.40625, 2.4140625, 2.421875, 2.4296875, 2.4375, 2.4453125, 2.453125, 2.4609375, 2.46875, 2.4765625, 2.484375, 2.4921875, 2.5, 2.5078125, 2.515625, 2.5234375, 2.53125, 2.5390625, 2.546875, 2.5546875, 2.5625, 2.5703125, 2.578125, 2.5859375, 2.59375, 2.6015625, 2.609375, 2.6171875, 2.625, 2.6328125, 2.640625, 2.6484375, 2.65625, 2.6640625, 2.671875, 2.6796875, 2.6875, 2.6953125, 2.703125, 2.7109375, 2.71875, 2.7265625, 2.734375, 2.7421875, 2.75, 2.7578125, 2.765625, 2.7734375, 2.78125, 2.7890625, 2.796875, 2.8046875, 2.8125, 2.8203125, 2.828125, 2.8359375, 2.84375, 2.8515625, 2.859375, 2.8671875, 2.875, 2.8828125, 2.890625, 2.8984375, 2.90625, 2.9140625, 2.921875, 2.9296875, 2.9375, 2.9453125, 2.953125, 2.9609375, 2.96875, 2.9765625, 2.984375, 2.9921875];

figure;
plot(t,sg);
hold on;
plot(t,sgfiltered);


peak_ind = [17.0, 32.0, 44.0, 55.0, 67.0, 80.0, 93.0, 107.0, 121.0, 135.0, 148.0, 160.0, 172.0, 183.0, 195.0, 208.0, 221.0, 235.0, 249.0, 263.0, 276.0, 288.0, 300.0, 311.0, 323.0, 336.0, 349.0, 363.0, 377.0];
peak_val = [0.48999689579615685, 0.9583933632074637, 1.2521083256590044, 1.1520512991959873, 0.6870480174134843, 0.008918890805301016, -0.6373387165526337, -0.9790268191230584, -0.8603873489853985, -0.3366468473431956, 0.36043281308664293, 0.9583933632074638, 1.2521083256590058, 1.1520512991959873, 0.6870480174134836, 0.008918890805300696, -0.6373387165526332, -0.97902681912306, -0.8603873489853983, -0.33664684734319505, 0.36043281308664493, 0.9583933632074657, 1.252108325659004, 1.152051299195988, 0.6870480174134858, 0.008918890805302527, -0.6373387165526333, -0.9790268191230573, -0.860387348985397];

stem(t(peak_ind),peak_val);
%% 

fs = 12;

times = [0.0, 0.079, 0.133, 0.187, 0.254, 0.319, 0.388, 0.441, 0.5, 0.564, 0.629, 1.012, 1.05, 1.105, 1.137, 1.183, 1.217, 1.248, 1.284, 1.317, 1.365, 1.39, 1.434, 1.466, 1.518, 1.574, 1.608, 1.638, 1.682, 1.712, 1.746, 1.786, 1.82, 1.878, 1.93, 1.968, 1.999, 2.033, 2.067, 2.105, 2.137, 2.18, 2.21, 2.247, 2.28, 2.316, 2.353, 2.385, 2.434, 2.464, 2.497, 2.53, 2.569, 2.614, 2.637, 2.68, 2.718, 2.746, 2.783, 2.813, 2.85, 2.885, 2.928, 2.96, 2.999, 3.033, 3.064, 3.103, 3.148, 3.178, 3.214, 3.246, 3.279, 3.315, 3.351, 3.384, 3.426, 3.46, 3.495, 3.528, 3.564, 3.601, 3.634, 3.675, 3.708, 3.744, 3.779, 3.815, 3.85, 3.891, 3.926, 3.959, 3.999, 4.029, 4.067, 4.1, 4.147, 4.172, 4.21, 4.242, 4.277, 4.312, 4.358, 4.392, 4.426, 4.458, 4.49, 4.528, 4.564, 4.599, 4.642, 4.674, 4.707, 4.742, 4.777, 4.815, 4.857, 4.891,...
4.928, 4.959, 4.991, 5.028, 5.061, 5.106, 5.14, 5.173, 5.206, 5.242, 5.279, 5.314, 5.356, 5.39, 5.423, 5.456, 5.49, 5.527, 5.564, 5.598, 5.639, 5.672, 5.709, 5.743, 5.778, 5.814, 5.855, 5.889, 5.923, 5.957, 5.991, 6.027, 6.062, 6.096, 6.138, 6.173, 6.206, 6.242, ...
6.276, 6.314, 6.355, 6.389, 6.423, 6.457, 6.489, 6.527, 6.563, 6.597, 6.637, 6.671, 6.706, 6.741, 6.777, 6.82, 6.857, 6.9, 6.923, 6.959, 6.998, 7.026, 7.062, 7.103, 7.881, 8.046, 8.12, 8.197, ...
8.266, 8.359, 8.444, 8.513, 8.581, 8.656, 8.722, 8.785, 8.849, 8.907, 8.972, 9.04, 9.106, 9.179, 9.259, 9.28, 9.333, 9.395, 9.461, 9.527, 9.599, 9.673, 9.751, 9.814, 9.871, 9.925, 9.985, 10.037, 10.086, 10.152, 10.207, 10.268, 10.326, 10.388, 10.454, 10.519, 10.569, 10.622, 10.687, 10.705, 10.753, 10.808, 10.874, 10.931, 10.982, 11.038,...
11.1, 11.155, 11.221, 11.241, 11.29, 11.354, 11.417, 11.477, 11.549, 11.611, ...
11.671, 11.74, 11.813, 11.877, 11.945, 12.008, 12.074, 12.139, 12.215, 12.274, 12.336, 12.398, 12.454, 12.505, 12.569, 12.638, 12.7, 12.767, 12.834, 12.89, 12.949, 13.016, 13.067, 13.119, 13.181, 13.236, 13.298, 13.356, 13.418, 13.482, 13.533, 13.587, 13.65, 13.703, 13.766, 13.83, 13.886, 13.952, 14.016, 14.082, 14.136, 14.201, 14.278, 14.348, 14.41, 14.485, 14.571, 14.656, 14.718, 14.736, 14.794, 14.853, 14.916, 14.985, 15.053, 15.115, 15.182, 15.265, 15.343, 15.412, 15.479, 15.537, 15.601, 15.667, 15.737, 15.8, 15.865, 15.933, 15.95, 16.007, 16.067, 16.136, 16.199, 16.267, 16.333, 16.4, 16.472, 16.536, 16.601, 16.669, 16.734, 16.807, 16.867, 16.935, 17.007, 17.072, 17.135, 17.205, 17.268, 17.336, 17.4, 17.47, 17.536,...
17.603, 17.671, 17.736, 17.802,17.876, 17.938, 18.005, 18.073, 18.14, ...
18.204, 18.268, 18.34, 18.403, 18.47, 18.54, 17.606, 18.673, 18.743, 18.81, 18.887, 18.957, 19.028, 19.1, 19.17, 19.237, 19.305, 19.372, 19.473, 19.539, 19.613, 19.69, 19.756, 19.824, 19.892, ...
19.957, 20.025, 20.09, 20.157, 20.225, 20.298, 20.379, 20.457, 20.543, 20.621, 20.688, 20.759, 20.843, 20.925, 21.01, 21.088, 21.171, 21.254, 21.332, 21.43, 21.547, 21.627, 21.708, 21.803, 21.89,... 
21.976, 22.083, 22.181, 22.284, 22.37, 22.457, 22.568, 22.657, 22.743, 22.827, 22.917, 22.994, 23.089, 23.167, 23.246, 23.33, 23.415, 23.493, 23.583, 23.669, 23.744, 23.829, 23.914, 23.995, 24.081, 24.166, 24.243, 24.329, 24.415, 24.497, 24.579, 24.666, 24.75, 24.829, 24.916, 25.001, 25.101, 25.188, 25.28, 25.364, 25.457, 25.551, 25.652, 25.759, 25.861, 25.961, 26.055, 26.154, 26.253, 26.358, 26.456, 26.555,...
26.657, 26.752, 26.854, 26.957, 27.055, 27.155, 27.261, 27.357, 27.46, 27.573, 27.683, 27.789, 27.898, 27.994, 28.092, 28.196, 28.292, 28.394, 28.493, 28.591, 28.699, 28.812, 28.913, 29.024, 29.135, 29.247, 29.265, 29.363, 29.468, 29.575, 29.682, 29.801, 29.913, 30.018, 30.129, 30.245, 30.371, 30.499, 30.632, 30.776, 30.903, 31.043, 31.189, 31.329, 31.468, 31.61, 31.748, 31.766, 31.896, 32.04, 32.164, 32.293, 32.416, 32.547, 32.676, 32.81, 32.873, 33.015];

pipa_heart = [251.67619791666667, 253.5387109375, 253.50421875, 237.00524739583332, 235.77805989583334, 96.7458984375, 85.16903645833334, 90.21041666666666, 90.5400390625, 114.19184895833334, 134.82263020833332, 141.74333333333334, 148.23321614583332, 144.63485677083332, 143.74013020833334, 142.7415625, 144.17709635416668, 145.9291015625, 148.3608984375, 148.18438802083332, 150.27565104166666, 150.36287760416667, 152.01627604166666, 153.23596354166668, 156.66645833333334, 159.666171875, 160.3045703125, 163.06079427083333, 163.96856770833332, 165.10572916666666, 165.9142578125, 162.51143229166667, 163.11623697916667, 162.2674609375, 161.92283854166666, 162.35891927083333, 162.13311197916667, 161.49108072916667, 163.55467447916666, 158.707578125, 157.57364583333333, 156.93322916666668, 160.02282552083332, 160.41546875, 161.9524609375, 164.18666666666667, 164.91729166666667, 164.94888020833332, 165.70244791666667, 165.78006510416665, 165.54794270833332, 165.60337239583333, 165.83884114583333, 165.917421875, 167.02677083333333, 167.45489583333332, 167.60692708333335, 167.65998697916666, 167.84029947916667, 168.03444010416666, 168.07463541666667, 167.63451822916667, 165.67666666666668, 163.2169921875, 162.00360677083333, 162.00541666666666, 162.60825520833333, 163.15979166666668, 163.59557291666667, 163.82471354166665, 163.7102734375, 163.4027734375, 163.18557291666667, 163.35467447916668, 163.65850260416667, 163.8984765625, 163.69638020833332, 163.27864583333334, 162.85092447916668, 162.57061197916667, 162.07446614583333, 161.88666666666666, 161.5881640625, 161.46404947916668, 161.08703125,161.08122395833334, 160.83782552083332, 160.91953125, 160.57052083333335, 159.09454427083332, 156.45036458333334, 155.10165364583332, 154.47583333333333, 154.467421875, 154.45130208333333, 154.56653645833333, 154.80611979166667, 154.89553385416667, 154.88403645833333, 154.8966015625, 155.07173177083334, 155.4070703125, 155.85295572916667, 156.3980078125, 156.82802083333334, 157.26002604166666, 157.6766796875, 158.096875, 158.5266796875, 158.79342447916667, 159.2661328125, 159.582421875, 160.14973958333334, 160.45770833333333, 160.927890625, 160.68981770833332, 159.186484375, 157.24833333333333, 159.167890625, 159.81122395833333, 160.07635416666668, 163.1566796875, 164.285625, 164.4671484375, 165.22932291666666, 165.42697916666665, 165.470078125, 165.93118489583333, 166.3442578125, 166.70591145833333, 167.10069010416666, 167.5171484375, 167.93783854166668, 168.2347265625, 168.38315104166668, 168.64209635416665, 168.79783854166666, 169.01196614583333, 169.18390625, 169.40381510416665, 169.05670572916668, 167.3158984375, 165.70725260416665, 165.0251171875, 165.10106770833335, 165.25946614583333, 165.55080729166667, 165.72709635416666, 166.04403645833332, 166.07522135416667, 166.0216015625, 165.95786458333333, 166.1675390625, 166.4678515625, 166.89248697916668, 167.290078125, 167.708046875, 167.9877734375, 168.19713541666667, 168.40115885416665, 168.4759765625, 168.54557291666666, 168.64376302083335, 168.94231770833332, 169.08458333333334, 169.3946484375, 169.65377604166667, 169.73609375, 168.40739583333334, 166.3276953125, 164.98311197916667, 164.49389322916667, 164.60837239583333, 164.62067708333333, 164.75052083333333, 164.93256510416666, 165.22401041666666, 165.19709635416666, 165.14877604166668, 165.15095052083333, 165.44815104166668, 167.88997395833334, 161.32588541666667, 163.60930989583332, 162.11694010416667, 159.90494791666666, 158.27651041666667, 163.17986979166668, 163.51484375, 163.69786458333334, 164.09192708333333, 164.28135416666666, 164.73170572916666, 165.14880208333332, 165.60973958333332, 163.63513020833332, 161.44703125, 160.18826822916665, 160.73928385416667, 161.43151041666667, 161.52509114583333, 161.34692708333333, 161.1325, 161.86397135416667, 162.67770833333333, 163.2482421875, 163.63372395833332, 163.9675390625, 164.41274739583332, 164.94790364583332, 165.19765625, 165.73776041666667, 166.0019140625, 165.16165364583333, 160.72477864583334, 160.00115885416668, 160.2980078125, 160.52361979166668, 161.1758203125, 160.8650390625, 160.90143229166668, 161.24653645833334, 162.133046875, 162.4448046875, 162.69959635416666, 162.935078125, 163.57411458333334, 164.07506510416667, 164.42571614583332, 164.94403645833333, 165.13532552083333, 165.15671875, 165.44890625, 165.73713541666666, 166.04272135416667, 166.183359375, 162.49783854166665, 160.48493489583333, 161.17536458333333, 162.08631510416666, 162.3694140625, 161.88265625, 162.08173177083333, 163.03298177083335, 163.70768229166666, 164.00786458333334, 164.240234375, 164.6171484375, 164.9882421875, 165.48811197916666, 166.02897135416666, 163.7965625, 160.60635416666668, 160.67930989583334, 161.08401041666667, 161.98911458333333, 162.21548177083332, 161.751015625, 162.19311197916667,...
 162.68471354166667, 163.43092447916666, 163.8266015625, 164.12364583333334, 164.28579427083332, 164.60576822916667, 164.80803385416667, 165.31407552083334, 165.2976953125, 163.38182291666666, 159.90236979166667, 159.9596484375, 160.22751302083333, 160.89408854166666, 161.10234375, 160.89684895833332, 161.09063802083332, 162.039765625, 162.48513020833335, 163.12326822916665, 163.564296875, 163.8192578125, 164.09735677083333, 164.5480859375, 165.018125, 165.59516927083334, 164.604296875, 160.178984375, 159.63505208333333, 160.45109375, 160.82108072916665, 161.0598046875, 160.92770833333333, 161.09796875, 161.92416666666668, 162.84588541666668, 163.33166666666668, 163.84700520833334, 164.0155078125, 164.66510416666668, 165.03873697916666, 165.48216145833334, 165.96069010416667, 166.15794270833334,...
 165.78138020833333, 161.1200390625, 160.30549479166666, 161.3301953125, 162.1960546875, 162.21828125, 161.92973958333334, 161.66509114583334, 162.07252604166666, 162.9844140625, 163.53438802083335, 163.9275, 164.18184895833335, 164.60768229166666, 165.08529947916668, 165.31916666666666, 165.03682291666667, 160.8759375, 160.42463541666666, 161.71981770833332, 162.60459635416666, 162.11809895833332, 162.323046875, 162.80325520833333, 163.61397135416667, 164.14567708333334, 164.33283854166666, 164.6050390625, 165.10140625, 165.34600260416667, 163.885703125, 159.90462239583334, 160.02259114583333, 160.9402734375, 161.65729166666668, 161.26838541666666, 161.67489583333332, 162.16149739583332, 163.01307291666666, 163.6671875, 164.08322916666665, 164.37498697916666, 164.8630078125,...
165.35700520833333, 164.44149739583332, 159.99447916666668, 159.47908854166667, 160.17063802083334, 160.965078125, 160.81997395833332, 161.05319010416667, 162.02665364583333, 162.82954427083334, 163.35799479166667, 163.71673177083332, 164.0474609375, 164.45157552083333, 164.9780078125, 163.16877604166666, 160.59915364583333, 159.52846354166667, 160.33010416666667, 160.98548177083333, 160.88634114583334, 160.77959635416667, 161.64817708333334, 162.48662760416667, 163.13033854166667, 163.64779947916668, 163.9045703125, 164.28772135416668, 164.75309895833334, 165.19384114583335, 161.0679296875, 159.48514322916665, 160.52333333333334, 161.63713541666667, 161.4034375, 161.31411458333332, 162.71490885416668, 163.36231770833334, 163.86240885416666, 164.35619791666667, 164.86751302083334, 165.09904947916667,...
159.40393229166668, 160.15920572916667, 161.13873697916668, 160.810078125, 161.30368489583333, 162.711171875, 163.52143229166666, 163.8848046875, 164.42006510416667, 164.48674479166667, 160.04274739583335, 158.89608072916667, 159.7454296875, 159.83307291666668, 160.10450520833334, 161.01709635416665, 161.7547265625, 162.596328125, 163.01580729166668, 163.54669270833332, 164.3830078125, 162.11819010416667, 158.47592447916668, 158.66572916666667, 159.36080729166667, 159.45815104166667, 159.63244791666668, 160.5915234375, 161.3709375, 162.189296875, 162.6253125, 163.07846354166668, 163.84958333333333, 163.77071614583335, 159.6079296875, 159.02510416666667, 159.92576822916666, 160.21373697916667, 159.92544270833332, 160.76958333333334, 161.8551171875, 162.27720052083333, 162.8183203125, ...
163.33984375, 161.87809895833334, 158.6859765625, 158.79315104166668,... 
159.5956640625, 159.29157552083333, 160.33537760416667, 160.96911458333332, 161.69438802083334, ...
162.60549479166667, 162.24514322916667, 158.51430989583332, 157.61875, 158.18869791666665, 157.98401041666668, 158.90018229166665, 160.12709635416667, 160.68817708333333, 161.5430859375, 162.43842447916666, 163.38890625, 158.61834635416668, 157.4928125, 157.73390625, 157.89319010416668,... 
158.789453125, 159.59013020833333, 160.67411458333333, 161.67303385416668, 162.5527734375, 163.30348958333335, 162.55888020833333, 158.82330729166668, 158.54434895833333, 159.15680989583333, 158.746640625, 159.71583333333334, 160.69868489583334, 161.39563802083333, 162.2615625, 162.629453125, 161.9409765625, 157.79752604166666, 158.07891927083332,...
158.32372395833335, 158.39514322916668, 159.50766927083333, 160.59111979166667, 161.50240885416667, 162.415703125, 162.72825520833334, 157.5253125, 157.81717447916665, 157.8810546875, 159.1750390625, 160.56055989583334, 161.79977864583333, 163.05657552083332, 161.21270833333332, 158.18828125, 158.99346354166667, 159.1014453125, 159.109765625, 160.65110677083334, 161.35790364583335, 162.4768359375, 163.685390625, 159.63348958333333, 160.631171875, 163.408671875, 162.3865234375];

t = linspace(0,times(end),fs*(times(end)-0)+1);

pipa_heartinterp =interp1(times,pipa_heart,t);

pipa_dart = [-0.6170450587720299, -0.5905392854231423, -0.487760091765606, -2.012902824332173, -3.954600198736081, -3.2825197441288787, -2.102878243007652, -7.260059564855141, -13.968229122981498, -9.738123049417071, -3.3066079858033337, -18.01697049729496, -39.113271838150396, -8.17598499187661, 97.83164783027433, 215.44538699651198, 258.2068222412428, 208.70038780478615, 122.1397444978941, 61.06250405212968, 48.9985575005505, 70.36683337449824, 94.4173113068196, 102.96570372788372, 101.10079073463822, 101.17137317556076, 104.86905859735268, 106.97075090343023, 106.60581813943561, 106.56935285736363, 108.70687995517102, 111.27420325061797, 114.14811517327395, 118.2065319476902, 122.25128024520566, 124.25604900336613, 123.44312850745851, 121.9069926733266, 120.97678914131754, 119.59957969769398, 117.59559987201331, 117.28497227670026, 119.87652817399358, 122.98503482273445, 123.89339158706106, 123.33662172001071, 123.76490578547349, 125.42944255469251, 126.12630795311625, 124.46315934266956, 121.77758473499256, 120.34619367449302, 120.66584057205073, 121.47439537942259, 121.81618826758493, 121.77666420502648, 121.43240406623153, 120.73710075387501, 120.20165300862294, 120.18040453860026, 119.69609133161431, 117.6661003197336, 114.93015470990699, 113.35777068129042, 113.3979626233813, 114.01484696951051, 114.55079782230399, 115.18342959447604, 116.0187310571713, 117.03002936026968, 118.1897979640193, 118.91786457005318, 118.48452831037183, 117.58260911146347, 118.03779547737052, 120.30442035159858, 122.73505913352905, 123.8678461838624, 124.07337655715381, 124.47479283142555, 125.43359632163731, 126.38294863338528, 126.37465670460227, 125.01145355866615, 123.17462978598053, 122.24563220654686, 122.44301866058132, 122.89674742254923, 123.2457274247744, 123.84031230622706, 124.58474437095231, 125.07237383974504, 125.57464366656693, 126.34348367189861, 126.4148238151609, 124.8235938667103, 122.52798210786467, 121.44408060607577, 121.87708345390948, 122.49390233454204, 122.50947130617882, 122.36196732973355, 122.43955869660407, 122.57156848057, 122.66374111567669, 122.79413830820596, 122.8005770206658, 122.66822172753749, 122.89662018264795, 123.62911365672187, 124.04284017362484, 123.39411099953092, 121.9518773303719, 120.25503741349802, 118.58489742702136, 117.67275492781408, 118.45556954277262, 120.43213652932414, 121.81241154945072, 121.99251292938277, 122.2174739911969, 123.06063174138895, 123.14920349583161, 121.46618901901546, 119.26732263781834, 118.41341130067204, 118.91692377156622, 119.44864904082273, 119.53306919899558, 119.87755510946029, 120.78823082887412, 121.56483742631818, 121.81483722829364, 122.24142584039849, 123.33798643708266, 124.00076315444826, 122.77247749166585, 120.16740478790798, 118.28631387659236, 118.15441594187718, 118.8165684910607, 119.18567606169061, 119.3822037532559, 119.94627551618763, 120.87013667677927, 121.72855202191768, 122.19589120701913, 122.43475233563161, 123.00472596868474, 123.8615224683977, 123.77190410024538, 121.94440601344958, 119.68649490994063, 118.9071988187191, 119.52054810398637, 120.052800840596, 120.1885943498039, 120.69339446926769, 121.4959350609331, 121.94762947278113, 122.3668513741971, 123.24498191994432, 123.57116662232595, 122.10577913062728, 119.79127381594436, 118.74707451014932, 119.2949397529629, 119.96101565756098, 120.11346135767481, 120.48468539518343, 121.29115717282427, 121.88247658672478, 122.25761918505802, 122.94410546367308, 123.34161183946678, 122.16841713475525, 119.76787355244927, 118.13217345086139, 118.23068999009892, 118.97023934695792, 119.28927246121873, 119.61445276839007, 120.54065647732945, 121.49017983516049, 121.77936939408889, 121.98543455134634, 122.87440169398474, 123.59284382554657, 122.5453102821501, 119.9850749991206, 118.04091108343238, 117.96353961552668, 118.79989505929184, 119.29123959838114, 119.56557395511754, 120.311364262377, 121.38389654012038, 122.04363496269697, 122.12112402123675, 122.36823740430617, 123.37598075859478, 124.31094825338882, 123.55232472329796, 121.10157133970856, 119.05627930872795, 118.88204521688355, 119.64409759955014, 119.96348485994437, 120.09803506875369, 120.73682161426296, 121.47765447253647, 121.93024235221992, 122.5936753247369, 123.30943267338809, 122.77939343597996, 120.79181224270076, 119.12273409053445, 119.09937610924607, 119.98138348101342, 120.57400203588644, 120.84372184487923, 121.23888977236136, 121.91465983599181, 122.81081184270882, 123.33194828929217, 122.44204468042537, 120.22144435347224, 118.4258189263387, 118.33160010748648, 119.18626708614143, 119.78698456633737, 120.13544957996383, 120.70302459641985, 121.46221692201537, 122.33999334114458, 123.16616991958985, 123.00124574241187, 121.16508976144095, 118.8152832064489, 117.82562328584054, 118.34941806261959, 119.10474604259313, 119.5621156952403, 120.19382061394978, 121.01752249592269, 121.63309496527681, 122.19026868739817, 122.80588802277217, 122.62092685469766, 120.96561802816979, 118.90412597288176, 118.07722941655503, 118.51395619494149, 119.02351021746996, 119.28848368482312, 119.92987292934106, 120.90014811769991, 121.51887829023829, 121.90670567203756, 122.62920883142121, 123.03222971078439, 121.86799695548741, 119.64197986419393, 118.34375894529278, 118.67069038263486, 119.39736811353613, 119.69041731758814, 120.06982565497479, 120.85242939771607, 121.58223866950377, 122.20247787890158, 122.93912403955372, 123.055672620065, 121.62467935375922, 119.42115740027445, 118.23259898073877, 118.48281882678896, 119.15246502169039, 119.66180719745212, 120.27063130612626, 121.0312672258337, 121.75331632595974, 122.44605186711293, 122.73367371817838, 121.74291692081921, 119.57322998456186, 117.76188378710634, 117.40530097557432, 117.93424913164272, 118.45390415661315, 118.98622447787032, 119.71675744293915, 120.39374265325608, 121.08862742837982, 122.06970131768817, 122.55960390661073, 121.27767479943087, 118.70258573025697, 116.9739811403462, 117.07608763753164, 117.82389829440491, 118.14649470145783, 118.51488710633393, 119.40846397977343, 120.2333140025725, 120.68242351305341, 121.39635667525346, 122.28524683792567, 121.95670109442968, 119.95243910875057, 117.95309329125615, 117.54589377488918, 118.22317318428975, 118.71868849244197, 118.93173647187513, 119.42248056771949, 120.23126751732907, 121.05702319376185, 121.60343901218599, 121.32767421574256, 119.91357138633842, 118.14949652926063, 117.2778364997735, 117.50996950834599, 118.06865116201385, 118.4285665393211, 118.74251321650858, 119.30829551658371, 120.22148259604911, 121.13866783280967, 121.18447038429578, 119.82083051576768, 117.83195803877827, 116.59685328128232, 116.46343453338702, 116.76638993709663, 117.18085429624018, 117.9022917596039, 118.74800885619646, 119.33940887942559, 119.9681945748193, 120.99728049683668, 121.61975118016555, 120.62404703214958, 118.32548133759555, 116.47429595256264, 116.085089318657, 116.51895072401338, 116.87512800171825, 117.21321718953996, 117.94822316475154, 118.89654476522925, 119.63867728034228, 120.32875212239858, 121.28438428274343, 121.94871262449425, 121.26261474170633, 119.31990764145897, 117.59836808180644, 117.12914613119709, 117.4295423169963, 117.6851599370319, 117.91272037335676, 118.40819210064475, 119.10768606199163, 119.96970089282557, 120.93710082111579, 121.2726484988297, 120.11989773975536, 118.0293655185512, 116.63940989587626, 116.59827928642508, 117.02086999837545, 117.19779070996977, 117.5463715264454, 118.41992994399604, 119.31135576884476, 119.8659032737235, 120.53823972010557, 121.39846506282204, 121.36955071097, 119.70625223178331, 117.42649041577562, 116.18433345042942, 116.26604139299627, 116.75465965001293, 117.16750398710431, 117.77332478621597, 118.63769365144246, 119.4322085590118, 120.12931554601536, 120.92588037261108, 121.43620079407991, 120.86165159737772, 119.24861078860556, 117.74318480789823, 117.23611239850042];


%pipa_heart = pipa_heart(fs*2+1:end);
%pipa_heart = pipa_heart - mean(pipa_heart);

%t = linspace(0,length(pipa_heart)/fs,length(pipa_heart));


figure;
%plot(t,  pipa_heart);
%hold on;

b = fir1(30,[2*0.1/fs, 2*3/fs],'bandpass'); 

pipa_smooth = filtfilt(b,[1],pipa_heartinterp);

plot(t, pipa_smooth);

[peaks,pos] =findpeaks(pipa_smooth);
[peaks_dart,pos_dart]=findpeaks(pipa_dart);

new_ind = [2.0, 6.0, 10.0, 16.0, 23.0, 27.0, 35.0, 44.0, 48.0, 54.0, 71.0, 81.0, 94.0, 100.0, 106.0, 110.0, 122.0, 135.0, 149.0, 162.0, 174.0, 187.0, 201.0, 213.0, 224.0, 235.0, 247.0, 260.0, 272.0, 283.0, 295.0, 307.0, 318.0, 330.0, 342.0, 355.0, 367.0, 379.0, 392.0]+1;


hold on
%stem(t(pos),peaks);
stem(t(new_ind),pipa_smooth(new_ind));
figure; 
plot(t(pos(3:end)),diff(diff(t(pos))));
timespan = t(pos(end))-t(pos(1));


figure;
plot(t,pipa_dart);
hold on;
stem(t(pos_dart),pipa_dart(pos_dart));
title('DART');
figure;
plot(t,pipa_dart);
hold on;
stem(t(new_ind),pipa_dart(new_ind));
title('Novos Indicies');

figure;
plot(t,pipa_smooth,t,pipa_dart);


%heart_rate = (length(peaks))/(length(pipa_heart)/fs)*60 %Not a problem in flutter (we have the time in flutter)
heart_rate = (length(peaks)-1)/timespan*60; %Not a problem in flutter (we have the time in flutter)

disp('Ola');

%fprintf('%s\n',sprintf(' %.2f',pipa_heart))

disp(t);

%% Fourier Transform Analysis
% PIPA INTERPOLATION
fs=60;
t = linspace(0,times(end),fs*(times(end)-0)+1);
pipa_heartinterp =interp1(times,pipa_heart,t);
freq=[0:2*fs/length(pipa_heartinterp):2*fs-(2*fs/length(pipa_heartinterp))];
freq=freq*60;
fftPipa=fft(pipa_heartinterp);
figure;
plot(freq(10:30),abs(fftPipa(10:30)));  %tirei os valores do freq


%pipa_heartinterp = pipa_heartinterp(fs*5:end);
freq=[0:2*fs/length(pipa_heartinterp):2*fs-(2*fs/length(pipa_heartinterp))];
freq=freq*60;


%%
pipa_heartinterp = pipa_heartinterp-mean(pipa_heartinterp);
pipa_heartinterp(1:30) = 0;

dp = diff(pipa_heartinterp);

plot(pipa_heartinterp-mean(pipa_heartinterp));

hold on

plot(diff(pipa_heartinterp));

[yP,xP] = cleverpeaks(pipa_heartinterp,1.5);

stem(xP,yP);

% [~,xv] = findpeaks(-diff(pipa_heartinterp));
% yv = dp(xv);
% 
% stem(xv,yv);

%% Confirmação produtos internos 
%Fazer isto standard para sinais com 30 segundos
prods = zeros(1,141);

figure(1);
plot(t,pipa_heartinterp/200,'k');
hold on;

for symPoint = 1:16
for i=1:141
    bpm=i+39;
    frequency = pi*bpm/30;
    band = sinc(0.5/30*t);
    gaussian=symWindow(t,symPoint);
    %gaussian(1:fs*5)=0;
    spiral= exp(-1j*frequency*t).*band.*gaussian;
    prods(i) = spiral*pipa_heartinterp';    
end

% a = 0.9;
% cx = [1-a];
% cy = [1,-a];
%prods = filter(cx,cy,prods);
% figure;
% plot(t,band);
% title('sinc');
figure(1);
plot(t,gaussian);
hold on;
title('Window');
figure(2);
plot(40:180,abs(prods).^2 / symPoint);
hold on;
title('Sampled FT');


end

function Y=symWindow(X, symPoint)

windowStart = 0;
windowLength = 300;
windowEdge = 5;

Y = zeros(1,length(X));
for i=1:length(X)
    Y(i)=symWindowAux(X(i),symPoint, windowStart, windowLength, windowEdge);
end

end

function y = symWindowAux(x, symPoint, windowStart, windowLength, windowEdge)

mean = windowStart + windowLength / 2;
halfwidth = windowLength / 2;
alfa = windowEdge / halfwidth;

if x <= symPoint
    y = turkeyAux(x,mean,halfwidth,alfa);
else
    y = turkeyAux(symPoint*2-x,mean,halfwidth,alfa);
end
end


function Y=turkey(X,mean,halfwidth,alfa)
Y = zeros(1,length(X));
for i=1:length(X)
    Y(i)=turkeyAux(X(i),mean,halfwidth,alfa);
end

end

function y=turkeyAux(x,mean,halfwidth,alfa)
N=100;
L=N;
n=N*(x-mean+halfwidth)/(2*halfwidth);
    if n<0
        y = 0;
    elseif 0 <= n && n < alfa*(L/2)
        y=0.5*(1-cos(2*pi*n/(alfa*L)));
    elseif  alfa*(L/2) <= n && n <= N/2
        y = 1;
    else
        y = turkeyAux(2*mean-x,mean,halfwidth,alfa);
    end
end





